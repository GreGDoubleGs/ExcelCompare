# uzupelnianie miasta suma o wykon i zgody

import pandas as pd
print(datetime.datetime.now())
miastaSuma = pd.read_excel("\\\\net\\network\\PROJEKTY\\PD\GG\\PEŁNE PLIKI MIAST\\UzupelnioneMiastaSuma.xlsx")
raportZgod = pd.read_excel("\\\\net\\network\\PROJEKTY\\PD\\GG\\20181214 Monitorowanie postępów pozyskwiania zgód 2018.xlsx", sheet_name = "Aktualizowana")
wykon = pd.read_excel("\\\\net\\network\\PROJEKTY\\PD\\GG\\Budynki_Sieć_XXI_20181214.xlsx", sheet_name = "Budynki_Sieć_XXI")


wykon = wykon[["city_name", "street_name", "building_number", "data"]] 
wykon.columns = ['Miasto', 'Ulica', "Nr_budynku", "Data wykonania"]
raportZgod = raportZgod[['Miasto', 'Ulica', "Numer budynku", "Data NIS"]]
raportZgod.columns = ['Miasto', 'Ulica', "Nr_budynku", "Data pozyskania zgody"]

miastaSuma = pd.merge(miastaSuma, wykon, on = ['Miasto','Ulica','Nr_budynku'], how = "left") # dodać województwo
miastaSuma = pd.merge(miastaSuma, raportZgod, on = ['Miasto','Ulica','Nr_budynku'], how = "left")
cols = ["ID_budynku", "RSU", "Technologia", "OLT", "SWITCH", "Wojewodztwo", "Miasto", "Ulica", "Nr_budynku", "Liczba_HP", "Nr_projektu", "Kierownik_projektu", "WZM_archiwa", "Aktualizacja_WZM", "Kontakt do WZM", "Umowa_WZM",  " Korespondencja z WZM", "Wykonanie_prac_projektowych_PL", "Wykonanie_prac_projektowych_WYK", "Gotowosc_infrastruktury_PL", "Gotowosc_infrastruktury_WYK", "Przekazanie_do_utrzymania", "Liczba_HP_(potwierdzona)", "Gotowosc_do_sprzedazy_PL", "Gotowosc_do_sprzedazy_WYK", "Zakonczenie_projektu", "Wykluczenie_z_realizacji", "Uwagi", "Konkurencja", "Data_ostatniej_aktualizacji", "Firma_realizaująca", "Przyczyna_opóźnień", "Gotowa sieć magistralna", "Gotowa sieć budynkowa i dosyłowa","Ocena", "Data wykonania", "Data pozyskania zgody"]
miastaSuma = miastaSuma[cols]  

miastaSuma.to_excel("\\\\net\\network\\PROJEKTY\\PD\GG\\PEŁNE PLIKI MIAST\\UzupelnioneMiastaSuma.xlsx", index = False)
print(datetime.datetime.now())
