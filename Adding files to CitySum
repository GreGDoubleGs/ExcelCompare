# Tworzenie Pliku Suma miast, potrzebne są poszczególne miasta + nagłówki

import openpyxl
import pandas as pd
import datetime
print(datetime.datetime.now())

wb2 = openpyxl.load_workbook("\\\\net\\network\\PROJEKTY\\PD\GG\\PEŁNE PLIKI MIAST\\nagłówki.xlsx")
ws2 = wb2['Raport']

        
listOfCities = ["Aleksandrów Łódzki", "Białystok", "Jelenia Góra", "Gdańsk", "Katowice"]
for miasto in listOfCities:
    try:    
        wb = openpyxl.load_workbook("\\\\net\\network\\PROJEKTY\\PD\GG\\PEŁNE PLIKI MIAST\\" + miasto +  "_raport.xlsx")
        ws = wb['Raport']
    except FileNotFoundError as e:
        print("Brak pliku " + miasto +  " o podanej ścieżce")
        continue
        
    startKopiowaniaMiasta = 0  # określa od jakiego wiersza znajduje sie lista budynków
    for i in range(1, ws.max_row):
        if ws.cell(row = i , column = 1).value == "ID_budynku" and ws.cell(row = i + 1 , column = 1).value == "tekst" \
        and  type(ws.cell(row = i + 2 , column = 1).value) == int:
            startKopiowaniaMiasta = i + 2
        elif ws.cell(row = i , column = 1).value == "ID_budynku" and type(ws.cell(row = i + 2 , column = 1).value) == int:
            startKopiowaniaMiasta = i + 1
            
    startWklejaniaMiastaSuma = 1  # określa od którego wiersza zaczyna wklejac budynki kolejnych miast
    while ws2.cell(row = startWklejaniaMiastaSuma, column = 7).value != None and ws2.cell(row = startWklejaniaMiastaSuma, column = 9).value != None:
        startWklejaniaMiastaSuma += 1
        
    for r in range(startKopiowaniaMiasta, ws.max_row):  #kopiowanie budynków z poszczególnych miast do miastaSuma
        for c in range(1, 36):
            ws2.cell(row = startWklejaniaMiastaSuma + r - startKopiowaniaMiasta, column = c).value = ws.cell(row = r, column = c).value
            

wb2.save("\\\\net\\network\\PROJEKTY\\PD\GG\\PEŁNE PLIKI MIAST\\UzupelnioneMiastaSuma.xlsx")    
print(datetime.datetime.now())
